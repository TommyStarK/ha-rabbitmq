version: '3.7'

networks:
  haOverlay:
    external: true

services:
  rabbitmq_node_3:
    image: harabbitmq:latest
    hostname: node3
    deploy:
      replicas: 1
    environment:
      - ERLANG_COOKIE=$ERLANG_COOKIE
      - RABBITMQ_NODENAME=node3
      - CLUSTERED=true
      - CLUSTERED_WITH=rabbit@node1
    ports:
      - target: 5671
        publish: 5671
        protocol: tcp
        mode: host
      - target: 5672
        publish: 5672
        protocol: tcp
        mode: host
      - target: 15671
        publish: 15671
        protocol: tcp
        mode: host
      - target: 15672
        publish: 15672
        protocol: tcp
        mode: host
    networks:
      haOverlay:
        aliases:
          - node3